services:
  npp-backend:
    build:
      context: ../dotnet
      dockerfile: Dockerfile
    container_name: npp-backend
    ports:
      - "5000:8080"
    volumes:
      - ../dotnet:/app
    working_dir: /app/NppApi
    command: dotnet watch run --urls "http://0.0.0.0:8080"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - DOTNET_WATCH_RESTART_ON_RUDE_EDIT=true
      - ConnectionStrings__Cassandra=Contact Points=cassandra;Port=9042
      - ConnectionStrings__Redis=redis:6379
#    depends_on:
#      cassandra:
#        condition: service_healthy
#      redis:
#        condition: service_started
    networks:
      - npp-network

  npp-frontend:
    build:
      context: ../react
      dockerfile: Dockerfile
    container_name: npp-frontend
    ports:
      - "3000:5173"
    volumes:
      - ../react:/app
      - /app/node_modules
    command: npm run dev -- --host 0.0.0.0
    environment:
      - VITE_API_URL=http://localhost:5000
    depends_on:
      - npp-backend
    networks:
      - npp-network

#  cassandra:
#    image: cassandra:5
#    container_name: npp-cassandra
#    ports:
#      - "9042:9042"
#    volumes:
#      - cassandra-data:/var/lib/cassandra
#    environment:
#      - CASSANDRA_CLUSTER_NAME=npp-cluster
#      - CASSANDRA_DC=dc1
#    healthcheck:
#      test: ["CMD-SHELL", "cqlsh -e 'describe cluster'"]
#      interval: 30s
#      timeout: 10s
#      retries: 5
#      start_period: 60s
#    networks:
#      - npp-network

#  redis:
#    image: redis:7-alpine
#    container_name: npp-redis
#    ports:
#      - "6379:6379"
#    volumes:
#      - redis-data:/data
#    command: redis-server --appendonly yes
#    networks:
#      - npp-network

networks:
  npp-network:
    driver: bridge

volumes:
  cassandra-data:
  redis-data:
